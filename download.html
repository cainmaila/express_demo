<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv='cache-control' content='no-cache'>
	<title>Download {mp4Id}</title>
	<style>
		body {
			font-family:Microsoft JhengHei;
			color : #0C2D9C;
		}
		#download {
			width : calc(100% - 100px);
			height : 200px;
			margin : 50px;
			background-color : #80BDCA;
			border-style : solid;
			border-width : 1px;
			border-color : #000000;
			line-height : 200px;
			font-size: 36px;
			text-align : center;
		}
		#cant_play {
			margin-left : 100px;
			font-size: 36px;
			color : #D11B3A;
			line-height : 50px;
		}
	</style>
	<script src="http://code.jquery.com/jquery-1.9.0.js"></script>
	<script src="http://127.0.0.1:6953/socket.io/socket.io.js"></script>
	<script>
	$(document).ready(function  () {
		var socket = io.connect("http://127.0.0.1:6953"),
			roomId = {IdHead};
		var clickDownload = function  () {
			location = "../{Id}";
		}
		socket.on("connection",function(data){
			socket.emit("initRoom",{id:roomId});
		});
		socket.on("initRoom",function(data){
			socket.emit("toRoom",{room:roomId,message:"ook!!"});
		});
		socket.on("data",function(data){
			console.log(data);
			if(data.progress == "end"){
				$("#mp4player").html("<video src='/mp4/{IdMp4}' controls >");
				$("#cant_play").html("");
				$("#download").html("下載 {IdMp4}").on("click",function  () {
					location = "../{IdMp4}";
				});
			}else if(data.progress == "error"){
				$("#cant_play").html("這個檔案無法轉檔");
			}else if(data.progress == "start"){
				$("#cant_play").html("開始轉檔");
			}else{
				$("#cant_play").html("" + (data.progress>>1<<1) + " %");
			}
		});
		// body...
		
		$("#download").on("click",clickDownload);
		$.get('/exists/{IdMp4}', function(data) {
			console.log(data);
			if(data == false){
				$.get("/inlist/{Id}", function  (data) {
					console.log(data);
					if(data==-1){
						$("#cant_play").html("這個檔案無法轉檔");
					}else if(data != -2){
						$("#cant_play").html("檔案駐列中，請稍等");
					}
				});
			}else{
				$("#mp4player").html("<video src='/mp4/{IdMp4}' controls >")
			}
		});
	})
	</script>
</head>
<body>
	<div id="download">下載 {Id}</div>
	<div id="mp4player"></div>
	<div id='cant_play'><div>
</body>
</html>